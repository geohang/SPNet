%% 无限元单元分析
function Kinfinite=Subfunction_Infinite_Element(sigma_background,I8,XYZ,Coordinate,Weight,NX,NY,NZ,ND)
Kinfinite=sparse(ND,ND);
for i=NX*NY*NZ+1:NX*NY*NZ+NZ*NY
    Ke=zeros(8,8);
    for j=1:8
        for l=1:8
            for k3=1:length(Coordinate)
                for k2=1:length(Coordinate)
                    for k1=1:length(Coordinate)
                        Jsingle=[(-(1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2;(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4;(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4];
                        kc1=I8(i,1);kc2=I8(i,2);kc3=I8(i,3);kc4=I8(i,4);kc5=I8(i,5);kc6=I8(i,6);kc7=I8(i,7);kc8=I8(i,8);
                        Jxyz=[XYZ(kc5,1),XYZ(kc5,2),XYZ(kc5,3);XYZ(kc6,1),XYZ(kc6,2),XYZ(kc6,3);XYZ(kc2,1),XYZ(kc2,2),XYZ(kc2,3);XYZ(kc1,1),XYZ(kc1,2),XYZ(kc1,3);XYZ(kc8,1),XYZ(kc8,2),XYZ(kc8,3);XYZ(kc7,1),XYZ(kc7,2),XYZ(kc7,3);XYZ(kc3,1),XYZ(kc3,2),XYZ(kc3,3);XYZ(kc4,1),XYZ(kc4,2),XYZ(kc4,3)];
                        JM=Jsingle*Jxyz;
                        JN_aabbcc=[(1+Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2;(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2;(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2];
                        JN_xyz=JM\JN_aabbcc;
                        Ke(j,l)=Ke(j,l)+Weight(k3)*Weight(k2)*Weight(k1)*(JN_xyz(1,j)*JN_xyz(1,l)+JN_xyz(2,j)*JN_xyz(2,l)+JN_xyz(3,j)*JN_xyz(3,l))*det(JM);
                    end
                end
            end
        end
    end
    Ke=Ke*sigma_background;
    kc1=I8(i,5);kc2=I8(i,6);kc3=I8(i,2);kc4=I8(i,1);kc5=I8(i,8);kc6=I8(i,7);kc7=I8(i,3);kc8=I8(i,4);
    kc=[kc1,kc2,kc3,kc4,kc5,kc6,kc7,kc8];
    for m=1:8
        for n=1:8
            Kinfinite=Kinfinite+sparse(kc(m),kc(n),Ke(m,n),ND,ND);
        end
    end
end
for i=NX*NY*NZ+NY*NZ+1:NX*NY*NZ+NY*NZ+NZ*NY
    Ke=zeros(8,8);
    for j=1:8
        for l=1:8
            for k3=1:length(Coordinate)
                for k2=1:length(Coordinate)
                    for k1=1:length(Coordinate)
                        Jsingle=[(-(1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2;(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4;(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4];
                        kc1=I8(i,1);kc2=I8(i,2);kc3=I8(i,3);kc4=I8(i,4);kc5=I8(i,5);kc6=I8(i,6);kc7=I8(i,7);kc8=I8(i,8);
                        Jxyz=[XYZ(kc7,1),XYZ(kc7,2),XYZ(kc7,3);XYZ(kc8,1),XYZ(kc8,2),XYZ(kc8,3);XYZ(kc4,1),XYZ(kc4,2),XYZ(kc4,3);XYZ(kc3,1),XYZ(kc3,2),XYZ(kc3,3);XYZ(kc6,1),XYZ(kc6,2),XYZ(kc6,3);XYZ(kc5,1),XYZ(kc5,2),XYZ(kc5,3);XYZ(kc1,1),XYZ(kc1,2),XYZ(kc1,3);XYZ(kc2,1),XYZ(kc2,2),XYZ(kc2,3)];
                        JM=Jsingle*Jxyz;
                        JN_aabbcc=[(1+Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2;(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2;(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2];
                        JN_xyz=JM\JN_aabbcc;
                        Ke(j,l)=Ke(j,l)+Weight(k3)*Weight(k2)*Weight(k1)*(JN_xyz(1,j)*JN_xyz(1,l)+JN_xyz(2,j)*JN_xyz(2,l)+JN_xyz(3,j)*JN_xyz(3,l))*det(JM);
                    end
                end
            end
        end
    end
    Ke=Ke*sigma_background;
    kc1=I8(i,7);kc2=I8(i,8);kc3=I8(i,4);kc4=I8(i,3);kc5=I8(i,6);kc6=I8(i,5);kc7=I8(i,1);kc8=I8(i,2);
    kc=[kc1,kc2,kc3,kc4,kc5,kc6,kc7,kc8];
    for m=1:8
        for n=1:8
            Kinfinite=Kinfinite+sparse(kc(m),kc(n),Ke(m,n),ND,ND);
        end
    end
end
for i=NX*NY*NZ+NY*NZ*2+1:NX*NY*NZ+NY*NZ*2+NX*NZ    
    Ke=zeros(8,8);
    for j=1:8
        for l=1:8
            for k3=1:length(Coordinate)
                for k2=1:length(Coordinate)
                    for k1=1:length(Coordinate)
                        Jsingle=[(-(1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2;(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4;(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4];
                        kc1=I8(i,1);kc2=I8(i,2);kc3=I8(i,3);kc4=I8(i,4);kc5=I8(i,5);kc6=I8(i,6);kc7=I8(i,7);kc8=I8(i,8);
                        Jxyz=[XYZ(kc6,1),XYZ(kc6,2),XYZ(kc6,3);XYZ(kc7,1),XYZ(kc7,2),XYZ(kc7,3);XYZ(kc3,1),XYZ(kc3,2),XYZ(kc3,3);XYZ(kc2,1),XYZ(kc2,2),XYZ(kc2,3);XYZ(kc5,1),XYZ(kc5,2),XYZ(kc5,3);XYZ(kc8,1),XYZ(kc8,2),XYZ(kc8,3);XYZ(kc4,1),XYZ(kc4,2),XYZ(kc4,3);XYZ(kc1,1),XYZ(kc1,2),XYZ(kc1,3)];
                        JM=Jsingle*Jxyz;
                        JN_aabbcc=[(1+Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2;(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2;(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2];
                        JN_xyz=JM\JN_aabbcc;
                        Ke(j,l)=Ke(j,l)+Weight(k3)*Weight(k2)*Weight(k1)*(JN_xyz(1,j)*JN_xyz(1,l)+JN_xyz(2,j)*JN_xyz(2,l)+JN_xyz(3,j)*JN_xyz(3,l))*det(JM);
                    end
                end
            end
        end
    end
    Ke=Ke*sigma_background;
    kc1=I8(i,6);kc2=I8(i,7);kc3=I8(i,3);kc4=I8(i,2);kc5=I8(i,5);kc6=I8(i,8);kc7=I8(i,4);kc8=I8(i,1);
    kc=[kc1,kc2,kc3,kc4,kc5,kc6,kc7,kc8];
    for m=1:8
        for n=1:8
            Kinfinite=Kinfinite+sparse(kc(m),kc(n),Ke(m,n),ND,ND);
        end
    end
end
for i=NX*NY*NZ+NY*NZ*2+NX*NZ+1:NX*NY*NZ+NY*NZ*2+NX*NZ+NX*NZ
    Ke=zeros(8,8);
    for j=1:8
        for l=1:8
            for k3=1:length(Coordinate)
                for k2=1:length(Coordinate)
                    for k1=1:length(Coordinate)
                        Jsingle=[(-(1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2;(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4;(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4];
                        kc1=I8(i,1);kc2=I8(i,2);kc3=I8(i,3);kc4=I8(i,4);kc5=I8(i,5);kc6=I8(i,6);kc7=I8(i,7);kc8=I8(i,8);
                        Jxyz=[XYZ(kc8,1),XYZ(kc8,2),XYZ(kc8,3);XYZ(kc5,1),XYZ(kc5,2),XYZ(kc5,3);XYZ(kc1,1),XYZ(kc1,2),XYZ(kc1,3);XYZ(kc4,1),XYZ(kc4,2),XYZ(kc4,3);XYZ(kc7,1),XYZ(kc7,2),XYZ(kc7,3);XYZ(kc6,1),XYZ(kc6,2),XYZ(kc6,3);XYZ(kc2,1),XYZ(kc2,2),XYZ(kc2,3);XYZ(kc3,1),XYZ(kc3,2),XYZ(kc3,3)];
                        JM=Jsingle*Jxyz;
                        JN_aabbcc=[(1+Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2;(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2;(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2];
                        JN_xyz=JM\JN_aabbcc;
                        Ke(j,l)=Ke(j,l)+Weight(k3)*Weight(k2)*Weight(k1)*(JN_xyz(1,j)*JN_xyz(1,l)+JN_xyz(2,j)*JN_xyz(2,l)+JN_xyz(3,j)*JN_xyz(3,l))*det(JM);
                    end
                end
            end
        end
    end
    Ke=Ke*sigma_background;
    kc1=I8(i,8);kc2=I8(i,5);kc3=I8(i,1);kc4=I8(i,4);kc5=I8(i,7);kc6=I8(i,6);kc7=I8(i,2);kc8=I8(i,3);
    kc=[kc1,kc2,kc3,kc4,kc5,kc6,kc7,kc8];
    for m=1:8
        for n=1:8
            Kinfinite=Kinfinite+sparse(kc(m),kc(n),Ke(m,n),ND,ND);
        end
    end
end
for i=NX*NY*NZ+NY*NZ*2+NX*NZ*2+1:NX*NY*NZ+NY*NZ*2+NX*NZ*2+NX*NY
    Ke=zeros(8,8);
    for j=1:8
        for l=1:8
            for k3=1:length(Coordinate)
                for k2=1:length(Coordinate)
                    for k1=1:length(Coordinate)
                        Jsingle=[(-(1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1+Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1-Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,(-(1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))-(1+Coordinate(k2))*(1-Coordinate(k3))*Coordinate(k1))/2/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1+Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1+Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1-Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1-Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2,((1+Coordinate(k2))*(1-Coordinate(k3))*(1-Coordinate(k1))+(1+Coordinate(k2))*(1-Coordinate(k3))*(1+Coordinate(k1)))/4/(1-Coordinate(k1))^2;(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k3))*(1+Coordinate(k1))/(1-Coordinate(k1))/4;(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(-2*Coordinate(k1))/(1-Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1-Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4,-(1+Coordinate(k2))*(1+Coordinate(k1))/(1-Coordinate(k1))/4];
                        kc1=I8(i,1);kc2=I8(i,2);kc3=I8(i,3);kc4=I8(i,4);kc5=I8(i,5);kc6=I8(i,6);kc7=I8(i,7);kc8=I8(i,8);
                        Jxyz=[XYZ(kc8,1),XYZ(kc8,2),XYZ(kc8,3);XYZ(kc7,1),XYZ(kc7,2),XYZ(kc7,3);XYZ(kc6,1),XYZ(kc6,2),XYZ(kc6,3);XYZ(kc5,1),XYZ(kc5,2),XYZ(kc5,3);XYZ(kc4,1),XYZ(kc4,2),XYZ(kc4,3);XYZ(kc3,1),XYZ(kc3,2),XYZ(kc3,3);XYZ(kc2,1),XYZ(kc2,2),XYZ(kc2,3);XYZ(kc1,1),XYZ(kc1,2),XYZ(kc1,3)];
                        JM=Jsingle*Jxyz;
                        JN_aabbcc=[(1+Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(4*Coordinate(k1)-1-3*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1+Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1-Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2,(1+Coordinate(k2))*(1-Coordinate(k3))/4*(-2*Coordinate(k1)-1+3*Coordinate(k1)*Coordinate(k1))/2;(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k3))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k3))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2;(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1-Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,-(1+Coordinate(k2))/4*(2*Coordinate(k1)*Coordinate(k1)-Coordinate(k1)-Coordinate(k1)*Coordinate(k1)*Coordinate(k1))/4,(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1-Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2,-(1+Coordinate(k2))/4*(-Coordinate(k1)*Coordinate(k1)-Coordinate(k1)+Coordinate(k1)*Coordinate(k1)*Coordinate(k1)+1)/2];
                        JN_xyz=JM\JN_aabbcc;
                        Ke(j,l)=Ke(j,l)+Weight(k3)*Weight(k2)*Weight(k1)*(JN_xyz(1,j)*JN_xyz(1,l)+JN_xyz(2,j)*JN_xyz(2,l)+JN_xyz(3,j)*JN_xyz(3,l))*det(JM);
                    end
                end
            end
        end
    end
    Ke=Ke*sigma_background;
    kc1=I8(i,8);kc2=I8(i,7);kc3=I8(i,6);kc4=I8(i,5);kc5=I8(i,4);kc6=I8(i,3);kc7=I8(i,2);kc8=I8(i,1);
    kc=[kc1,kc2,kc3,kc4,kc5,kc6,kc7,kc8];
    for m=1:8
        for n=1:8
            Kinfinite=Kinfinite+sparse(kc(m),kc(n),Ke(m,n),ND,ND);
        end
    end
end
end